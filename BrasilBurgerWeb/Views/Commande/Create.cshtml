@{
    ViewData["Title"] = "Passer une commande";
    var produit = ViewBag.Produit;
    var typeProduit = ViewBag.TypeProduit;
    var prixBase = ViewBag.PrixBase;
    var boissons = ViewBag.Boissons as List<BrasilBurgerWeb.Models.Complement>;
    var frites = ViewBag.Frites as List<BrasilBurgerWeb.Models.Complement>;
    var zones = ViewBag.Zones as List<BrasilBurgerWeb.Models.Zone>;
}

<div class="container mt-4">
    <h2 class="text-danger mb-4">
        <i class="bi bi-cart-plus"></i> Passer une commande
    </h2>

    <form asp-action="Create" method="post">
        @if (typeProduit == "BURGER")
        {
            var burger = produit as BrasilBurgerWeb.Models.Burger;
            <input type="hidden" name="burgerId" value="@burger.Id" />

            <!-- Produit s√©lectionn√© -->
            <div class="card mb-4">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            @if (!string.IsNullOrEmpty(burger.ImageUrl))
                            {
                                <img src="@burger.ImageUrl" class="img-fluid rounded" alt="@burger.Libelle">
                            }
                        </div>
                        <div class="col-md-9">
                            <h4>@burger.Libelle</h4>
                            <p class="text-muted">@burger.Description</p>
                            <h5 class="text-danger">@burger.Prix.ToString("N0") FCFA</h5>
                        </div>
                    </div>
                </div>
            </div>
        }
        else if (typeProduit == "MENU")
        {
            var menu = produit as BrasilBurgerWeb.Models.Menu;
            <input type="hidden" name="menuId" value="@menu.Id" />

            <!-- Produit s√©lectionn√© -->
            <div class="card mb-4">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            @if (!string.IsNullOrEmpty(menu.ImageUrl))
                            {
                                <img src="@menu.ImageUrl" class="img-fluid rounded" alt="@menu.Libelle">
                            }
                        </div>
                        <div class="col-md-9">
                            <h4>@menu.Libelle</h4>
                            <p class="text-muted">
                                üçî @menu.Burger?.Libelle +
                                ü•§ @menu.Boisson?.Libelle +
                                üçü @menu.Frite?.Libelle
                            </p>
                            <h5 class="text-danger">@menu.PrixTotal.ToString("N0") FCFA</h5>
                        </div>
                    </div>
                </div>
            </div>
        }

        <!-- Compl√©ments -->
        <div class="card mb-4">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0">Compl√©ments</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    @if (boissons != null && boissons.Any())
                    {
                        <div class="col-md-6">
                            <h6>ü•§ Boissons</h6>
                            @foreach (var boisson in boissons)
                            {
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" name="complementIds" value="@boisson.Id"
                                        id="boisson@(boisson.Id)">
                                    <label class="form-check-label" for="boisson@(boisson.Id)">
                                        @boisson.Libelle
                                        <span class="text-muted">(@boisson.Prix.ToString("N0") FCFA)</span>
                                    </label>
                                </div>
                            }
                        </div>
                    }

                    @if (frites != null && frites.Any())
                    {
                        <div class="col-md-6">
                            <h6>üçü Frites</h6>
                            @foreach (var frite in frites)
                            {
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" name="complementIds" value="@frite.Id"
                                        id="frite@(frite.Id)">
                                    <label class="form-check-label" for="frite@(frite.Id)">
                                        @frite.Libelle
                                        <span class="text-muted">(@frite.Prix.ToString("N0") FCFA)</span>
                                    </label>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Mode de consommation -->
        <div class="card mb-4">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0">Mode de consommation</h5>
            </div>
            <div class="card-body">
                <div class="form-check mb-3">
                    <input class="form-check-input" type="radio" name="modeConsommation" id="surPlace" value="SUR_PLACE"
                        required>
                    <label class="form-check-label" for="surPlace">
                        <strong>Sur place</strong>
                        <p class="text-muted small mb-0">Consommer au restaurant</p>
                    </label>
                </div>

                <div class="form-check mb-3">
                    <input class="form-check-input" type="radio" name="modeConsommation" id="aEmporter"
                        value="A_EMPORTER" required>
                    <label class="form-check-label" for="aEmporter">
                        <strong>√Ä emporter</strong>
                        <p class="text-muted small mb-0">R√©cup√©rer au comptoir</p>
                    </label>
                </div>

                <div class="form-check mb-3">
                    <input class="form-check-input" type="radio" name="modeConsommation" id="livraison"
                        value="LIVRAISON" required>
                    <label class="form-check-label" for="livraison">
                        <strong>Livraison</strong>
                        <p class="text-muted small mb-0">Se faire livrer √† domicile</p>
                    </label>
                </div>

                <!-- Zone de livraison (affich√©e si Livraison est s√©lectionn√©e) -->
                <div id="livraisonDetails" style="display: none;">
                    <hr>
                    <div class="mb-3">
                        <label for="zoneId" class="form-label">Zone de livraison</label>
                        <select class="form-select" id="zoneId" name="zoneId">
                            <option value="">-- S√©lectionner une zone --</option>
                            @if (zones != null)
                            {
                                @foreach (var zone in zones)
                                {
                                    <option value="@zone.Id">
                                        @zone.Nom (+@zone.PrixLivraison.ToString("N0") FCFA)
                                    </option>
                                }
                            }
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="adresseLivraison" class="form-label">Adresse de livraison</label>
                        <textarea class="form-control" id="adresseLivraison" name="adresseLivraison"
                            rows="3"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Prix total estim√© -->
        <div class="card mb-4 border-danger">
            <div class="card-body">
                <h4 class="text-danger">
                    Prix total estim√© : <span id="prixTotal">@prixBase.ToString("N0")</span> FCFA
                </h4>
            </div>
        </div>

        <!-- Boutons -->
        <div class="d-grid gap-2">
            <button type="submit" class="btn btn-danger btn-lg">
                <i class="bi bi-check-circle"></i> Valider la commande
            </button>
            <a asp-controller="Catalogue" asp-action="Index" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Retour au catalogue
            </a>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        // Afficher/masquer les d√©tails de livraison
        document.querySelectorAll('input[name="modeConsommation"]').forEach(radio => {
            radio.addEventListener('change', function () {
                const livraisonDetails = document.getElementById('livraisonDetails');
                if (this.value === 'LIVRAISON') {
                    livraisonDetails.style.display = 'block';
                    document.getElementById('zoneId').required = true;
                    document.getElementById('adresseLivraison').required = true;
                } else {
                    livraisonDetails.style.display = 'none';
                    document.getElementById('zoneId').required = false;
                    document.getElementById('adresseLivraison').required = false;
                }
            });
        });
    </script>
}